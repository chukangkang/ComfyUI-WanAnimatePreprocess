# WanAnimatePreprocess 优化配置文件
# 根据您的硬件配置调整这些参数

[batch_processing]
# 批量大小设置 (支持自动、保守、平衡、激进四种模式)
# auto: 根据总帧数自动计算 (推荐)
# conservative: 4-8 (8GB 显存)
# balanced: 8-16 (12GB+ 显存, 默认)
# aggressive: 16-32 (24GB+ 显存)
batch_size_mode = auto

# 如果希望使用固定批量大小，设置这里 (0 = 禁用自动计算)
batch_size_fixed = 0

[onnx_optimization]
# ONNX Runtime 图优化级别
# 0 = 禁用优化
# 1 = 基础优化
# 2 = 完整优化 (推荐, 默认)
graph_optimization_level = 2

# CPU 线程数 (根据 CPU 核心数调整)
# 0 = 自动 (推荐)
# 4 = 四核 CPU
# 8 = 八核 CPU
# 16 = 十六核 CPU
intra_op_num_threads = 0

[memory_optimization]
# 启用连续内存优化
enable_contiguous_array = true

# 启用内存预分配 (可以减少碎片)
enable_memory_preallocation = true

[inference_settings]
# 启用 FP16 精度 (如果模型支持, 可加快推理)
# 注意: 可能影响精度
enable_fp16 = false

# 启用后端融合 (减少算子数量)
enable_backend_fusion = true

[performance_tuning]
# 启用详细的性能日志
enable_performance_logging = false

# 在处理前进行显存预热 (可以稳定性能)
enable_gpu_warmup = true

# 显存预热的帧数
gpu_warmup_frames = 2

[advanced]
# 最大批量大小上限 (防止显存溢出)
max_batch_size = 32

# 最小批量大小下限 (低于此值则不进行批量处理)
min_batch_size = 4

# 启用自适应批量大小 (根据 GPU 负载动态调整, 实验性)
enable_adaptive_batch = false

# 启用帧跳过检测 (连续相似帧跳过检测, 实验性)
enable_frame_skipping = false

# 帧相似度阈值 (0-1, 值越高越严格)
frame_similarity_threshold = 0.95

# 使用配置说明:
# 
# 1. 对于 8GB 显存的 GPU:
#    batch_size_mode = conservative
#    graph_optimization_level = 2
#    intra_op_num_threads = 4
#
# 2. 对于 12GB 显存的 GPU (推荐):
#    batch_size_mode = balanced
#    graph_optimization_level = 2
#    intra_op_num_threads = 8
#
# 3. 对于 24GB+ 显存的 GPU:
#    batch_size_mode = aggressive
#    graph_optimization_level = 2
#    intra_op_num_threads = 16
#
# 4. 对于仅有 CPU 的环境:
#    batch_size_mode = conservative
#    graph_optimization_level = 1
#    intra_op_num_threads = 0
#
# 5. 追求最高性能 (需要 24GB+ 显存):
#    batch_size_mode = aggressive
#    graph_optimization_level = 2
#    intra_op_num_threads = 16
#    enable_fp16 = true
#    enable_gpu_warmup = true
#    enable_adaptive_batch = true
